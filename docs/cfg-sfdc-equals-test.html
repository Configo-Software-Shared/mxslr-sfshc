<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Equals Operator Test - == vs =</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
    <script type="text/javascript" src="script/cfg-sfdc-tokens.js"></script>
  </head>
  <body>
    <div class="ui container" style="margin-top: 2rem">
      <h1 class="ui header">
        <i class="equals icon"></i>
        <div class="content">
          Equals Operator Test
          <div class="sub header">Testing == vs = Operator Tokenization</div>
        </div>
      </h1>

      <div class="ui info message">
        <div class="header">Test Purpose</div>
        <p>
          This page tests that the <code>==</code> operator is properly
          recognized as a single two-character operator and not split into two
          separate <code>=</code> operators.
        </p>
      </div>

      <!-- Test Formulas -->
      <div class="ui segment">
        <h3 class="ui header">
          <i class="code icon"></i>
          Test Formulas
        </h3>
        <p>These formulas should show <code>==</code> as a single operator:</p>

        <div class="ui grid">
          <div class="sixteen wide column">
            <h4>Formula from Screenshot:</h4>
            <div id="formula1"></div>
          </div>
        </div>

        <div class="ui grid">
          <div class="sixteen wide column">
            <h4>Additional == Tests:</h4>
            <div id="formula2"></div>
          </div>
        </div>

        <div class="ui grid">
          <div class="sixteen wide column">
            <h4>Mixed = and == Tests:</h4>
            <div id="formula3"></div>
          </div>
        </div>
      </div>

      <!-- Tokenization Debug -->
      <div class="ui segment">
        <h3 class="ui header">
          <i class="bug icon"></i>
          Tokenization Debug
        </h3>
        <p>Raw tokenization results for the first formula:</p>
        <div id="tokenization-debug"></div>
      </div>

      <!-- Operator List -->
      <div class="ui segment">
        <h3 class="ui header">
          <i class="list icon"></i>
          Recognized Operators
        </h3>
        <p>Operators that should be recognized:</p>
        <div id="operator-list"></div>
      </div>
    </div>

    <script>
      // Test formulas
      const testFormulas = {
        formula1: "IF (TEXT (SBQQ__ColumnOrder__c) == '', TRUE, FALSE)",
        formula2:
          'IF([Status] == "Active", "Yes", "No")\nIF([Amount] == 1000, "High", "Low")',
        formula3:
          'IF([Status] = "Active" && [Amount] == 1000, "Match", "No Match")',
      };

      function initializeTests() {
        // Test the formula from the screenshot
        document.getElementById("formula1").innerHTML = createFormulaCodeBlock(
          testFormulas.formula1,
          {
            prettify: true,
            showCopyButton: true,
            showLineNumbers: true,
          }
        );

        // Test additional == examples
        document.getElementById("formula2").innerHTML = createFormulaCodeBlock(
          testFormulas.formula2,
          {
            prettify: true,
            showCopyButton: true,
            showLineNumbers: true,
          }
        );

        // Test mixed = and == examples
        document.getElementById("formula3").innerHTML = createFormulaCodeBlock(
          testFormulas.formula3,
          {
            prettify: true,
            showCopyButton: true,
            showLineNumbers: true,
          }
        );

        // Show tokenization debug
        const tokens = tokenizeFormula(testFormulas.formula1);
        const classifiedTokens = classifyTokens(tokens);

        const debugHtml = `
          <div class="ui info message">
            <div class="header">Tokenization Results</div>
            <pre style="background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto;">
${classifiedTokens.map((t) => `${t.type}: "${t.value}"`).join("\n")}
            </pre>
          </div>
        `;

        document.getElementById("tokenization-debug").innerHTML = debugHtml;

        // Display recognized operators
        const operatorListHtml = OPERATORS.map(
          (op) => `<span class="ui label">${op}</span>`
        ).join(" ");

        document.getElementById("operator-list").innerHTML = operatorListHtml;
      }

      // Initialize when page loads
      document.addEventListener("DOMContentLoaded", function () {
        initializeTests();
        initializeFormulaCopyButtons();
      });
    </script>
  </body>
</html>
